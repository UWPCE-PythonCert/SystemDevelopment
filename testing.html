

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Testing &mdash; System Development With Python 2.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="System Development With Python 2.0 documentation" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> System Development With Python
          

          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <!-- Local TOC -->
                <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Testing</a><ul>
<li><a class="reference internal" href="#what-is-testing">What is testing?</a></li>
<li><a class="reference internal" href="#terminology-of-testing">Terminology of testing</a></li>
<li><a class="reference internal" href="#v-model-and-tests-levels">&#8220;V&#8221; model and tests levels</a></li>
<li><a class="reference internal" href="#unit-testing">Unit testing</a></li>
<li><a class="reference internal" href="#what-should-be-tested">What should be tested?</a></li>
<li><a class="reference internal" href="#unit-testing-tools">Unit-testing tools</a></li>
<li><a class="reference internal" href="#about-unit-testing">About Unit-testing</a></li>
<li><a class="reference internal" href="#unittest-testcase-anatomy">unittest.TestCase anatomy</a></li>
<li><a class="reference internal" href="#assert-methods">Assert Methods</a></li>
<li><a class="reference internal" href="#fixtures-setting-up-your-tests-for-success">Fixtures: Setting up your tests for success</a></li>
<li><a class="reference internal" href="#testing-floating-point-values">Testing floating point values</a></li>
<li><a class="reference internal" href="#levels-of-precision-of-floating-point">levels of precision of floating point</a></li>
<li><a class="reference internal" href="#assertalmostequal">assertAlmostEqual</a></li>
<li><a class="reference internal" href="#running-your-tests">Running your tests</a></li>
<li><a class="reference internal" href="#test-suites">Test Suites</a></li>
<li><a class="reference internal" href="#nose2">Nose2</a></li>
<li><a class="reference internal" href="#nose2-plugins">nose2 plugins</a></li>
<li><a class="reference internal" href="#running-coverage">running coverage</a></li>
<li><a class="reference internal" href="#branch-coverage">branch coverage</a></li>
<li><a class="reference internal" href="#doctests">Doctests</a></li>
<li><a class="reference internal" href="#test-driven-development-tdd">Test Driven Development (TDD)</a></li>
<li><a class="reference internal" href="#exercises">Exercises</a></li>
<li><a class="reference internal" href="#context-managers-via-the-with-statement">Context managers via the &#8220;with&#8221; statement</a></li>
<li><a class="reference internal" href="#writing-a-context-manager">Writing a context manager</a></li>
<li><a class="reference internal" href="#context-manager-exercise">Context Manager exercise</a></li>
<li><a class="reference internal" href="#now-we-ve-got-the-tools-to-really-test">Now we&#8217;ve got the tools to really test</a></li>
<li><a class="reference internal" href="#using-mock-objects-to-test-an-application-with-service-dependencies">Using Mock objects to test an application with service dependencies</a></li>
<li><a class="reference internal" href="#mocks">Mocks</a></li>
<li><a class="reference internal" href="#easy-mocking-with-mock-patch">Easy mocking with mock.patch</a></li>
<li><a class="reference internal" href="#using-patch">Using patch</a></li>
<li><a class="reference internal" href="#id2">Exercises</a></li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">System Development With Python</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Testing</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/testing.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="testing">
<span id="id1"></span><h1>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h1>
<p>System Development with Python</p>
<p>Git repository:</p>
<p><a class="reference external" href="https://github.com/UWPCE-PythonCert/SystemDevelopment">https://github.com/UWPCE-PythonCert/SystemDevelopment</a></p>
<div class="section" id="what-is-testing">
<h2>What is testing?<a class="headerlink" href="#what-is-testing" title="Permalink to this headline">¶</a></h2>
<p>Code which runs your application in as close to a real environment as
feasible and validates its behavior</p>
</div>
<div class="section" id="terminology-of-testing">
<h2>Terminology of testing<a class="headerlink" href="#terminology-of-testing" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Unit tests</li>
<li>Integration tests</li>
<li>High level system tests</li>
<li>Acceptance tests</li>
<li>Black box / White box testing</li>
</ul>
</div>
<div class="section" id="v-model-and-tests-levels">
<h2>&#8220;V&#8221; model and tests levels<a class="headerlink" href="#v-model-and-tests-levels" title="Permalink to this headline">¶</a></h2>
<img alt="_images/test_v_model.png" src="_images/test_v_model.png" />
</div>
<div class="section" id="unit-testing">
<h2>Unit testing<a class="headerlink" href="#unit-testing" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Test smallest discrete units of source code</li>
<li>Tests should be independent of each other</li>
<li>Can separate tests from required resources through fixtures and
mocking</li>
<li>Automatable</li>
<li>Integrates with development process</li>
</ul>
</div>
<div class="section" id="what-should-be-tested">
<h2>What should be tested?<a class="headerlink" href="#what-should-be-tested" title="Permalink to this headline">¶</a></h2>
<p>The percentage of code which gets run in a test is known as the
coverage.</p>
<p>100% coverage is an ideal to strive for. But the decision on when and
what to test should take into account the volatility of the project.</p>
</div>
<div class="section" id="unit-testing-tools">
<h2>Unit-testing tools<a class="headerlink" href="#unit-testing-tools" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>unittest, the test framework that ships with Python. Started life as PyUnit.
<a class="reference external" href="http://docs.python.org/3/library/unittest.html">http://docs.python.org/3/library/unittest.html</a></li>
<li>nose2, a test runner which integrates with unittest, making it nicer and easier
<a class="reference external" href="http://nose2.readthedocs.org/en/latest/">http://nose2.readthedocs.org/en/latest/</a></li>
<li>mock, an object mocking library. Ships with Python 3.3+
<a class="reference external" href="https://docs.python.org/dev/library/unittest.mock.html">https://docs.python.org/dev/library/unittest.mock.html</a></li>
<li>pytest, an alternative to unittest, which you should be pretty familiar with now
<a class="reference external" href="http://pytest.org/latest/">http://pytest.org/latest/</a></li>
</ul>
</div>
<div class="section" id="about-unit-testing">
<h2>About Unit-testing<a class="headerlink" href="#about-unit-testing" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Tests should be independent.</li>
<li>Tests do not run in order, which shouldn&#8217;t matter, see point 1.</li>
<li>Test fixtures are available to do any setup needed for tests.</li>
</ol>
</div>
<div class="section" id="unittest-testcase-anatomy">
<h2>unittest.TestCase anatomy<a class="headerlink" href="#unittest-testcase-anatomy" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>create a new subclass of unittest.TestCase</li>
<li>name test methods test_foo so the test runner finds them</li>
<li>make calls to the self.assert* family of methods to validate results</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">unittest</span>

<span class="k">class</span> <span class="nc">TestTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">test_add</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="assert-methods">
<h2>Assert Methods<a class="headerlink" href="#assert-methods" title="Permalink to this headline">¶</a></h2>
<p>TestCase contains a number of methods named assert* which can be used
for validation, here are a few common ones:</p>
<ul class="simple">
<li>assertEqual(first, second, msg=None)</li>
<li>assertNotEqual(first, second, msg=None)</li>
<li>assertTrue(expr, msg=None)</li>
<li>assertFalse(expr, msg=None)</li>
<li>assertIn(first, second)</li>
<li>assertRaises(exc, fun, msg=None, *args, **kwargs)</li>
</ul>
<p>See a full list at
<a class="reference external" href="http://docs.python.org/3/library/unittest.html#assert-methods">http://docs.python.org/3/library/unittest.html#assert-methods</a> or
dir(unittest.TestCase) or to get really fancy</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;assert&#39;</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="section" id="fixtures-setting-up-your-tests-for-success">
<h2>Fixtures: Setting up your tests for success<a class="headerlink" href="#fixtures-setting-up-your-tests-for-success" title="Permalink to this headline">¶</a></h2>
<p>(or failure!)</p>
<p>Test fixtures are a fixed baseline for tests to run from consistently,
also known as test context</p>
<p>Fixtures can be set up fresh before each test, once before each test
case, or before an entire test suite</p>
<p>unittest provides fixture support via these methods:</p>
<ul class="simple">
<li>setUp / tearDown - these are run before and after each test method</li>
<li>setUpClass / tearDownClass - these are run before/after each TestCase</li>
<li>setUpModule / tearDownModule - run before/after each TestSuite</li>
<li>(new in Python 2.7) addCleanup / doCleanups - called after tearDown,
in case a test throws an exception</li>
</ul>
</div>
<div class="section" id="testing-floating-point-values">
<h2>Testing floating point values<a class="headerlink" href="#testing-floating-point-values" title="Permalink to this headline">¶</a></h2>
<p>Why can&#8217;t we just test if .5 == .5 ?</p>
<div class="highlight-python"><div class="highlight"><pre>In [1]: 3*.15 == .45
Out[1]: False

In [2]: 3*.15
Out[2]: 0.44999999999999996

In [3]: 3*.15 * 10 / 10  == .45
Out[3]: True
</pre></div>
</div>
<p>There are an infinite number of floating point numbers, so they are
stored as an approximation in computing hardware.</p>
<p><a class="reference external" href="https://docs.python.org/3/tutorial/floatingpoint.html">https://docs.python.org/3/tutorial/floatingpoint.html</a></p>
</div>
<div class="section" id="levels-of-precision-of-floating-point">
<h2>levels of precision of floating point<a class="headerlink" href="#levels-of-precision-of-floating-point" title="Permalink to this headline">¶</a></h2>
<p>Floating point numbers are stored in <a class="reference external" href="http://en.wikipedia.org/wiki/IEEE_floating_point">IEEE
754</a> 64-bit double
precision format, so 1 bit for the sign, 11 bits for the exponent, and
the remaining 52 for the fraction</p>
<p>So we can count on 16 digits of precision in decimal:</p>
<div class="highlight-python"><div class="highlight"><pre>In [39]: len(str(2**52))
Out[39]: 16

In [40]: .1+.2
Out[40]: 0.30000000000000004

In [41]: len(&#39;3000000000000000&#39;)
Out[41]: 16

# with repeated operations, the errors eventually build up: here&#39;s multiplying by &#39;1&#39; 10 million times:
In [64]: x=1
In [69]: for i in range(10000000): x *= (.1 + .2)/.3
Out [69]: 1.000000002220446
</pre></div>
</div>
</div>
<div class="section" id="assertalmostequal">
<h2>assertAlmostEqual<a class="headerlink" href="#assertalmostequal" title="Permalink to this headline">¶</a></h2>
<p>Verifies that two floating point values are close enough to each other.
Add a places keyword argument to specify the number of significant
digits.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">unittest</span>

<span class="k">class</span> <span class="nc">TestAlmostEqual</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">test_floating_point</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">3</span><span class="o">*.</span><span class="mi">15</span><span class="p">,</span> <span class="o">.</span><span class="mi">45</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_almost_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="mi">3</span><span class="o">*.</span><span class="mi">15</span><span class="p">,</span> <span class="o">.</span><span class="mi">45</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="running-your-tests">
<h2>Running your tests<a class="headerlink" href="#running-your-tests" title="Permalink to this headline">¶</a></h2>
<p>Call unittest.main() right in your module</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>If it gets cumbersome with many TestCases, organize the tests into a
test suite</p>
</div>
<div class="section" id="test-suites">
<h2>Test Suites<a class="headerlink" href="#test-suites" title="Permalink to this headline">¶</a></h2>
<p>Test suites group test cases into a single testable unit</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">unittest</span>

<span class="kn">from</span> <span class="nn">calculator_test</span> <span class="kn">import</span> <span class="n">TestCalculatorFunctions</span>

<span class="n">suite</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestLoader</span><span class="p">()</span><span class="o">.</span><span class="n">loadTestsFromTestCase</span><span class="p">(</span><span class="n">TestCalculatorFunctions</span><span class="p">)</span>

<span class="n">unittest</span><span class="o">.</span><span class="n">TextTestRunner</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">suite</span><span class="p">)</span>
</pre></div>
</div>
<p>Tests can also be organized into suites in the if __name__ == &#8220;__main__&#8221;: block</p>
</div>
<div class="section" id="nose2">
<h2>Nose2<a class="headerlink" href="#nose2" title="Permalink to this headline">¶</a></h2>
<p>Nose2 is the new nose. Nose is barely being maintained, and directs users to nose2.</p>
<p>A test runner which autodiscovers test cases</p>
<p>Nose2 will find tests for you so you can focus on writing tests, not
maintaining test suites</p>
<p>To find tests, nose2 looks for modules (such as python files) whose names start with ‘test’. In those modules, nose2 will load tests from all unittest.TestCase subclasses, as well as functions whose names start with ‘test’.</p>
<p>Running your tests is as easy as</p>
<div class="highlight-python"><div class="highlight"><pre>$ nose2
</pre></div>
</div>
<p><a class="reference external" href="http://nose2.readthedocs.org/en/latest/getting_started.html#running-tests">http://nose2.readthedocs.org/en/latest/getting_started.html#running-tests</a></p>
</div>
<div class="section" id="nose2-plugins">
<h2>nose2 plugins<a class="headerlink" href="#nose2-plugins" title="Permalink to this headline">¶</a></h2>
<p>Many plugins exist for nose2, such as code coverage:
Some plugins, such as coverage, must be additionally installed</p>
<div class="highlight-python"><div class="highlight"><pre>$ pip install cov-core
# now it can be used
$ nose2 --with-coverage
</pre></div>
</div>
<p>Some of many useful plugins installed by default:</p>
<ul class="simple">
<li>Test Generators  <a class="reference external" href="http://nose2.readthedocs.org/en/latest/plugins/generators.html">http://nose2.readthedocs.org/en/latest/plugins/generators.html</a></li>
<li>Parameterized Tests  <a class="reference external" href="http://nose2.readthedocs.org/en/latest/plugins/parameters.html">http://nose2.readthedocs.org/en/latest/plugins/parameters.html</a></li>
<li>Stop after first error or failuer -F</li>
<li>Drop in to the debugger on failure -D</li>
</ul>
</div>
<div class="section" id="running-coverage">
<h2>running coverage<a class="headerlink" href="#running-coverage" title="Permalink to this headline">¶</a></h2>
<p>Install with Pip. Written by Ned Batchelder</p>
<p>To run coverage on your test suite:</p>
<div class="highlight-python"><div class="highlight"><pre>coverage run my_program.py arg1 arg2
</pre></div>
</div>
<p>This generates a .coverage file. To analyze it on the console:</p>
<div class="highlight-python"><div class="highlight"><pre>coverage report
</pre></div>
</div>
<p>Else generate an HTML report in the current directory:</p>
<div class="highlight-python"><div class="highlight"><pre>coverage html
</pre></div>
</div>
<p>To find out coverage across the standard library, add -L:</p>
<div class="highlight-python"><div class="highlight"><pre>-L, --pylib           Measure coverage even inside the Python installed
                      library, which isn&#39;t done by default.
</pre></div>
</div>
</div>
<div class="section" id="branch-coverage">
<h2>branch coverage<a class="headerlink" href="#branch-coverage" title="Permalink to this headline">¶</a></h2>
<p>consider the following code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">x</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c"># 1</span>
<span class="k">if</span> <span class="n">x</span><span class="p">:</span>      <span class="c"># 2</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;in branch&quot;</span><span class="p">)</span>  <span class="c"># 3</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;out of branch&quot;</span><span class="p">)</span>  <span class="c"># 4</span>
</pre></div>
</div>
<p>We want to make sure the branch is being bypassed correctly in the False
case</p>
<p>Track which branch destinations were not visited with the &#8211;branch
option to run</p>
<div class="highlight-python"><div class="highlight"><pre>coverage run --branch myprog.py
</pre></div>
</div>
<p><a class="reference external" href="http://nedbatchelder.com/code/coverage/branch.html">http://nedbatchelder.com/code/coverage/branch.html</a></p>
</div>
<div class="section" id="doctests">
<h2>Doctests<a class="headerlink" href="#doctests" title="Permalink to this headline">¶</a></h2>
<p>Tests placed in docstrings to demonstrate usage of a component to a
human in a machine testable way</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Squares x.</span>

<span class="sd">    &gt;&gt;&gt; square(2)</span>
<span class="sd">    4</span>
<span class="sd">    &gt;&gt;&gt; square(-2)</span>
<span class="sd">    4</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>python -m doctest -v example.py
</pre></div>
</div>
<p>Now generate documentation, using epydoc for example:</p>
<div class="highlight-python"><div class="highlight"><pre>$ epydoc example.py
</pre></div>
</div>
<p><a class="reference external" href="http://docs.python.org/3/library/doctest.html">http://docs.python.org/3/library/doctest.html</a></p>
<p><a class="reference external" href="http://www.python.org/dev/peps/pep-0257/">http://www.python.org/dev/peps/pep-0257/</a></p>
<p><a class="reference external" href="http://epydoc.sourceforge.net/">http://epydoc.sourceforge.net/</a></p>
<p><a class="reference external" href="http://sphinx-doc.org/">http://sphinx-doc.org/</a></p>
<p><a class="reference external" href="http://www.doxygen.org">http://www.doxygen.org</a></p>
</div>
<div class="section" id="test-driven-development-tdd">
<h2>Test Driven Development (TDD)<a class="headerlink" href="#test-driven-development-tdd" title="Permalink to this headline">¶</a></h2>
<p>In TDD, the tests are written the meet the requirements before the code
exists.</p>
<p>Once the collection of tests passes, the requirement is considered met.</p>
<p>We don&#8217;t always want to run the entire test suite. In order to run a
single test with nose:</p>
<div class="highlight-python"><div class="highlight"><pre>nose2 calculator_test.TestCalculatorFunctions.test_add
</pre></div>
</div>
</div>
<div class="section" id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Add unit tests for each method in calculator_functions.py</li>
<li>Add fixtures via setUp/tearDown methods and setUpClass/tearDownClass
class methods. Are they behaving how you expect?</li>
<li>Add additional unit tests for floating point calculations</li>
<li>Fix any failures in the code</li>
<li>Add doctests to calculator_functions.py</li>
</ul>
<p>One more Python feature before getting back to testing..
the &#8220;with&#8221; statement</p>
</div>
<div class="section" id="context-managers-via-the-with-statement">
<h2>Context managers via the &#8220;with&#8221; statement<a class="headerlink" href="#context-managers-via-the-with-statement" title="Permalink to this headline">¶</a></h2>
<p>If you&#8217;ve been opening files using &#8220;with&#8221; (and you probably should be),
you have been using context managers:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>A context manager is just a class with __enter__ and __exit__
methods defined to handle setting up and tearing down the context</p>
<p>Provides generalizable execution contexts in which setup and teardown of
context are executed no matter what happens</p>
<p>This allows us to do things like setup/teardown and separate out
exception handling code</p>
</div>
<div class="section" id="writing-a-context-manager">
<h2>Writing a context manager<a class="headerlink" href="#writing-a-context-manager" title="Permalink to this headline">¶</a></h2>
<p>Define __enter__(self) and __exit__(self, type, value,
traceback) on a class</p>
<p>If __exit__ returns a true value, a caught exception is not
re-raised</p>
<p>For example :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">random</span><span class="o">,</span> <span class="nn">shutil</span><span class="o">,</span> <span class="nn">time</span>

<span class="k">class</span> <span class="nc">TemporaryDirectory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A context manager for creating a temporary directory which gets destroyed on context exit&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">directory</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_directory</span> <span class="o">=</span> <span class="n">directory</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># set things up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_directory</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="c"># tear it down</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>

<span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">(</span><span class="s">&quot;/tmp/foo&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">dir</span><span class="p">:</span>
    <span class="c"># write some temp data into dir</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="s">&quot;foo.txt&quot;</span><span class="p">),</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference external" href="http://www.python.org/dev/peps/pep-0343/">http://www.python.org/dev/peps/pep-0343/</a></p>
</div>
<div class="section" id="context-manager-exercise">
<h2>Context Manager exercise<a class="headerlink" href="#context-manager-exercise" title="Permalink to this headline">¶</a></h2>
<p>Create a context manager which prints information on all exceptions
which occur in the context and continues execution</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">YourExceptionHandler</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;do some stuff here&quot;</span><span class="p">)</span>
    <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;should still reach this point&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Why might using a context manager be better than implementing this with
try..except..finally ?</p>
<p>Also see the <a class="reference external" href="http://docs.python.org/3/library/contextlib.html">contextlib
module</a></p>
</div>
<div class="section" id="now-we-ve-got-the-tools-to-really-test">
<h2>Now we&#8217;ve got the tools to really test<a class="headerlink" href="#now-we-ve-got-the-tools-to-really-test" title="Permalink to this headline">¶</a></h2>
<p>Consider the application in the examples/wikidef directory. Give the
command line utility a subject, and it will return a definition.</p>
<div class="highlight-python"><div class="highlight"><pre>./define.py  Robot | html2text
</pre></div>
</div>
<p>How can we test our application code without abusing (and waiting for)
Wikipedia?</p>
</div>
<div class="section" id="using-mock-objects-to-test-an-application-with-service-dependencies">
<h2>Using Mock objects to test an application with service dependencies<a class="headerlink" href="#using-mock-objects-to-test-an-application-with-service-dependencies" title="Permalink to this headline">¶</a></h2>
<p>Mock objects replace real objects in your code at runtime during test</p>
<p>This allows you to test code which calls these objects without having
their actual code run</p>
<p>Useful for testing objects which depend on unimplemented code, resources
which are expensive, or resources which are unavailable during test
execution</p>
<p><a class="reference external" href="http://www.voidspace.org.uk/python/mock">http://www.voidspace.org.uk/python/mock</a></p>
</div>
<div class="section" id="mocks">
<h2>Mocks<a class="headerlink" href="#mocks" title="Permalink to this headline">¶</a></h2>
<p>The MagickMock class will keep track of calls to it so we can verify
that the class is being called correctly, without having to execute the
code underneath</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">mock</span>

<span class="n">mock_object</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">MagicMock</span><span class="p">()</span>
<span class="n">mock_object</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="s">&quot;foo return&quot;</span>
<span class="k">print</span><span class="p">(</span><span class="n">mock_object</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">call_count</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">mock_object</span><span class="o">.</span><span class="n">foo</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">mock_object</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">call_count</span><span class="p">)</span>
<span class="c"># raise an exception by assigning to the side_effect attribute</span>
<span class="n">mock_object</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">Exception</span>
<span class="n">mock_object</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="easy-mocking-with-mock-patch">
<h2>Easy mocking with mock.patch<a class="headerlink" href="#easy-mocking-with-mock-patch" title="Permalink to this headline">¶</a></h2>
<p>patch acts as a function decorator, class decorator, or a context
manager</p>
<p>Inside the body of the function or with statement, the target is patched
with a new object. When the function/with statement exits the patch is
undone</p>
</div>
<div class="section" id="using-patch">
<h2>Using patch<a class="headerlink" href="#using-patch" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># patch with a decorator</span>
<span class="nd">@patch.object</span><span class="p">(</span><span class="n">Wikipedia</span><span class="p">,</span> <span class="s">&#39;article&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_article_success_decorator_mocked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_method</span><span class="p">):</span>
    <span class="n">article</span> <span class="o">=</span> <span class="n">Definitions</span><span class="o">.</span><span class="n">article</span><span class="p">(</span><span class="s">&quot;Robot&quot;</span><span class="p">)</span>
    <span class="n">mock_method</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s">&quot;Robot&quot;</span><span class="p">)</span>

<span class="c"># patch with a context manager</span>
<span class="k">def</span> <span class="nf">test_article_success_context_manager_mocked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">Wikipedia</span><span class="p">,</span> <span class="s">&#39;article&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_method</span><span class="p">:</span>
        <span class="n">article</span> <span class="o">=</span> <span class="n">Definitions</span><span class="o">.</span><span class="n">article</span><span class="p">(</span><span class="s">&quot;Robot&quot;</span><span class="p">)</span>
        <span class="n">mock_method</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s">&quot;Robot&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference external" href="http://www.voidspace.org.uk/python/mock/patch.html">http://www.voidspace.org.uk/python/mock/patch.html</a></p>
</div>
<div class="section" id="id2">
<h2>Exercises<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>When define.py is given the name of a non-existant article, an exception
is thrown.</p>
<p>Add a new test that confirms this behavior</p>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Christopher Barker, Joseph Sheedy, Maria McKinley.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>