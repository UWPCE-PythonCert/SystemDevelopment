

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Debugging &mdash; System Development With Python 2.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="System Development With Python 2.0 documentation" href="index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html" class="fa fa-home"> System Development With Python</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Debugging</a><ul>
<li><a class="reference internal" href="#topics">Topics</a><ul>
<li><a class="reference internal" href="#the-call-stack">The Call Stack</a></li>
<li><a class="reference internal" href="#visualize-the-stack">Visualize the stack!</a></li>
<li><a class="reference internal" href="#exceptions">Exceptions</a></li>
<li><a class="reference internal" href="#id2">Debugging</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">System Development With Python</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Debugging</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/debugging.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="debugging">
<span id="id1"></span><h1>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Maria McKinley</li>
</ul>
<p><code class="docutils literal"><span class="pre">parody&#64;uw.edu</span></code></p>
<div class="section" id="topics">
<h2>Topics<a class="headerlink" href="#topics" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>The call stack</li>
<li>Exceptions</li>
<li>Iterators</li>
<li>Debugging</li>
</ul>
<div class="section" id="the-call-stack">
<h3>The Call Stack<a class="headerlink" href="#the-call-stack" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>A stack is a Last-In-First-Out (LIFO) data structure (stack of plates)</li>
<li>The call stack is a stack data structure that stores information
about the current active function call</li>
<li>The objects in the stack are known as &#8220;stack frames&#8221;. Each frame
contains the arguments passed to the function, space for local
variables, and the return address</li>
<li>When a function is called, a stack frame is created for it and pushed
onto the stack</li>
<li>When a function returns, it is popped off the stack and control is
passed to the next item in the stack. If the stack is empty, the
program exits</li>
</ul>
<p><a class="reference external" href="http://www.pythontutor.com/visualize.html#mode=edit">http://www.pythontutor.com/visualize.html#mode=edit</a></p>
</div>
<div class="section" id="visualize-the-stack">
<h3>Visualize the stack!<a class="headerlink" href="#visualize-the-stack" title="Permalink to this headline">¶</a></h3>
<a class="reference internal image-reference" href="_images/program_callstack.png"><img alt="_images/program_callstack.png" src="_images/program_callstack.png" style="height: 580px;" /></a>
<p class="rubric" id="how-deep-can-that-stack-be">How deep can that stack be?</p>
<div class="highlight-python"><div class="highlight"><pre>i = 0

def recurse():
    global i
    i += 1
    print i
    recurse()

recurse()
</pre></div>
</div>
<p>That value can be changed with sys.setrecursionlimit(N)</p>
<p>If we try to put more than sys.getrecursionlimit() frames on the stack, we get a RuntimeError, which is python&#8217;s version of StackOverflow</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">inspect</span>

<span class="k">def</span> <span class="nf">recurse</span><span class="p">(</span><span class="n">limit</span><span class="p">):</span>
    <span class="n">local_variable</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span> <span class="o">*</span> <span class="n">limit</span>
    <span class="k">print</span> <span class="n">limit</span><span class="p">,</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getargvalues</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">limit</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">recurse</span><span class="p">(</span><span class="n">limit</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">recurse</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>module &lt;<a class="reference external" href="https://docs.python.org/2/library/inspect.html">https://docs.python.org/2/library/inspect.html</a>&gt;`__</p>
</div>
<div class="section" id="exceptions">
<h3>Exceptions<a class="headerlink" href="#exceptions" title="Permalink to this headline">¶</a></h3>
<p>It&#8217;s easier to ask for forgiveness than permission</p>
<p>When either the interpreter or your own code detects an error condition,
an exception will be raised</p>
<p>The exception will bubble up the call stack until it is handled. If it&#8217;s
not, the interpreter will exit the program.</p>
<p>At each level in the stack, a handler can either:</p>
<ul class="simple">
<li>let it bubble through (the default)</li>
<li>swallow the exception</li>
<li>catch the exception and raise it again</li>
<li>catch the exception and raise a new one</li>
</ul>
<p class="rubric" id="handling-exceptions">Handling exceptions</p>
<p>The most basic form uses the builtins try and except</p>
<div class="highlight-python"><div class="highlight"><pre>try:
    print &quot;do some stuff&quot;
    1 / 0
    print &quot;do some more stuff&quot;
except:
    print &quot;stuff failed&quot;
</pre></div>
</div>
<p class="rubric" id="a-few-more-builtins-for-exception-handling-finally-else-and-raise">A few more builtins for exception handling: finally, else,
and raise</p>
<div class="highlight-python"><div class="highlight"><pre>try:
    result = x / y

except ZeroDivisionError as e:
    print &quot;caught division error: %s&quot; % str(e)

except Exception as e:
    print &quot;unhandled exception %s.  message: %s &quot; % (type(e), e.args)
    raise

else:
    print &quot;everything worked great&quot;
    return result

finally:
    print &quot;this is executed no matter what&quot;
</pre></div>
</div>
<p class="rubric" id="built-in-exceptions">Built-in exceptions</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">__builtin__</span><span class="p">)</span> <span class="k">if</span> <span class="s">&quot;Error&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">]</span>
</pre></div>
</div>
<p>Use the builtin exceptions when you can, add messages if you need to.
If none meet your needs, define a new exception type by subclassing one,
perhaps Exception.</p>
<p>If one of these meets your needs, by all means use it. Else, define a
new exception type by subclassing one, perhaps Exception</p>
<p class="rubric" id="exercise">Exercise</p>
<p>Modify the example program examples/wikidef</p>
<p>Enforce the argument to api.Wikipedia.title to have length greater than
0</p>
<p>If a 0 length argument is passed to this function, raise a new exception
called ZeroLengthTitleError</p>
<p>Handle this exception in the caller (Not necessarily the immediate
caller, which one makes sense to you?)</p>
<p>Feel free to edit the code in place. You can throw away your changes at
the end with &#8220;git reset &#8211;hard&#8221;, store them for later with &#8220;git stash&#8221;,
or commit them!</p>
<p class="rubric" id="further-reading">Further reading</p>
<ul class="simple">
<li><a class="reference external" href="https://wiki.python.org/moin/HandlingExceptions">https://wiki.python.org/moin/HandlingExceptions</a></li>
<li><a class="reference external" href="http://docs.python.org/2/library/exceptions.html">http://docs.python.org/2/library/exceptions.html</a></li>
<li><a class="reference external" href="http://docs.python.org/2/tutorial/errors.html">http://docs.python.org/2/tutorial/errors.html</a></li>
</ul>
</div>
<div class="section" id="id2">
<h3>Debugging<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="python-debugging">Python Debugging</p>
<p>You will spend most of your time as a developer debugging.
You will spend more time than you expect on google.</p>
<p>Debuggers are code which allows the inspection of state of other code
during runtime.</p>
<p>Rudimentary tools</p>
<ul class="simple">
<li>print()</li>
<li>interpreter hints</li>
<li>import logging.debug</li>
<li>assert()</li>
</ul>
<p>Console debuggers</p>
<ul class="simple">
<li>pdb/ipdb</li>
</ul>
<p>GUI debuggers</p>
<ul class="simple">
<li>Winpdb</li>
<li>IDEs: Eclipse, Wing IDE, PyCharm, Visual Studio</li>
</ul>
<p class="rubric" id="help-from-the-interpreter">help from the interpreter</p>
<p>investigate import issues with -v</p>
<p>inspect environment after running script with -i</p>
<p class="rubric" id="pdb-the-python-debugger"><a class="reference external" href="http://docs.python.org/2/library/pdb.html">Pdb - The Python
Debugger</a></p>
<p>Pros:</p>
<ul class="simple">
<li>You have it already, ships with the standard library</li>
<li>Easy remote debugging</li>
<li>Works with any development environment</li>
</ul>
<p>Cons:</p>
<ul class="simple">
<li>Steep-ish learning curve</li>
<li>Easy to get lost in a deep stack</li>
<li>Watching variables isn&#8217;t hard, but non-trivial</li>
</ul>
</div><div class="section slide"><p class="rubric" id="pdb-the-python-debugger-1"><a class="reference external" href="http://docs.python.org/2/library/pdb.html">Pdb - The Python
Debugger</a></p>
<p>The 4-fold ways of invoking pdb</p>
<ul class="simple">
<li>Postmortem mode</li>
<li>Run mode</li>
<li>Script mode</li>
<li>Trace mode</li>
</ul>
<p>Note: in most cases where you see the word &#8216;pdb&#8217; in the examples, you
can replace it with &#8216;ipdb&#8217;. ipdb is the ipython enhanced version of pdb
which is mostly compatible, and generally easier to work with. But it
doesn&#8217;t ship with Python.</p>
</div><div class="section slide"><p class="rubric" id="postmortem-mode">Postmortem mode</p>
<p>For analyzing crashes due to uncaught exceptions</p>
<div class="highlight-python"><div class="highlight"><pre>python -i script.py
import pdb; pdb.pm()
</pre></div>
</div>
</div><div class="section slide"><p class="rubric" id="run-mode">Run mode</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">pdb</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s">&#39;some.expression()&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div><div class="section slide"><p class="rubric" id="script-mode">Script mode</p>
<div class="highlight-python"><div class="highlight"><pre>python -m pdb script.py
</pre></div>
</div>
<p>&#8220;-m [module]&#8221; finds [module] in sys.path and executes it as a script</p>
</div><div class="section slide"><p class="rubric" id="trace-mode">Trace mode</p>
<p>Insert the following line into your code where you want execution to
halt:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pdb</span><span class="p">;</span> <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
</pre></div>
</div>
<p>It&#8217;s not always OK/possible to modify your code in order to debug it,
but this is often the quickest way to begin inspecting state</p>
</div><div class="section slide"><p class="rubric" id="pdb-in-ipython">pdb in ipython</p>
<div class="highlight-python"><div class="highlight"><pre>In [2]: pdb
Automatic pdb calling has been turned ON

%run app.py

# now halts execution on uncaught exception
</pre></div>
</div>
<p>If you forget to turn on pdb, the magic command %debug will activate the
debugger (in &#8216;post-mortem mode&#8217;).</p>
</div><div class="section slide"><p class="rubric" id="navigating-pdb">Navigating pdb</p>
<p>The goal of each of the preceding techniques was to get to the pdb
prompt and get to work inspecting state</p>
<div class="highlight-python"><div class="highlight"><pre>% python -m pdb define.py robot
  pdb&gt; break api.py:21
  # list breakpoints
  pdb&gt; break
  pdb&gt; clear 1
  # print lines of code in current context
  pdb&gt; list
  # print lines in range
  pdb&gt; list 1,28
  # print stack trace, aliased to (bt, w)
  pdb&gt; where
  # move one level up the stack
  pdb&gt; up
  # move one level down the stack
  pdb&gt; down
  # execute until function returns
  pdb&gt; return
  # Execute the current line, stop at the first possible occasion
  pdb&gt; step
  # Continue execution until the next line in the current function is reached or it returns.
  pdb&gt; next
  # Continue execution until the line with a number greater than the current one is reached or until the current frame returns.  Good for exiting loops.
  pdb&gt; until
  # create commands to be executed on a breakpoint
  pdb&gt; commands
  pdb&gt; continue
</pre></div>
</div>
</div><div class="section slide"><p class="rubric" id="breakpoints">Breakpoints</p>
<div class="highlight-python"><div class="highlight"><pre>pdb&gt; help break
  b(reak) ([file:]lineno | function) [, condition]
  With a line number argument, set a break there in the current
  file.  With a function name, set a break at first executable line
  of that function.  Without argument, list all breaks.  If a second
  argument is present, it is a string specifying an expression
  which must evaluate to true before the breakpoint is honored.

  The line number may be prefixed with a filename and a colon,
  to specify a breakpoint in another file (probably one that
  hasn&#39;t been loaded yet).  The file is searched for on sys.path;
  the .py suffix may be omitted.
</pre></div>
</div>
<p>Clear (delete) breakpoints</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">clear</span> <span class="p">[</span><span class="n">bpnumber</span> <span class="p">[</span><span class="n">bpnumber</span><span class="o">...</span><span class="p">]]</span>
</pre></div>
</div>
<p>disable breakpoints</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">disable</span> <span class="p">[</span><span class="n">bpnumber</span> <span class="p">[</span><span class="n">bpnumber</span><span class="o">...</span><span class="p">]]</span>
</pre></div>
</div>
<p>enable breakpoints</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">enable</span> <span class="p">[</span><span class="n">bpnumber</span> <span class="p">[</span><span class="n">bpnumber</span><span class="o">...</span><span class="p">]]</span>
</pre></div>
</div>
</div><div class="section slide"><p class="rubric" id="conditional-breakpoints">Conditional Breakpoints</p>
<div class="highlight-python"><div class="highlight"><pre>pdb&gt; help condition
condition bpnumber str_condition
str_condition is a string specifying an expression which
must evaluate to true before the breakpoint is honored.
If str_condition is absent, any existing condition is removed;
i.e., the breakpoint is made unconditional.
</pre></div>
</div>
<p>Set conditions</p>
<div class="highlight-python"><div class="highlight"><pre>condition 1 x==1
</pre></div>
</div>
<p>Clear conditions</p>
<div class="highlight-python"><div class="highlight"><pre>condition 1
</pre></div>
</div>
<p>see debugging/examples/long_loop.py</p>
</div><div class="section slide"><p class="rubric" id="invoking-pdb-with-nose">Invoking pdb with nose</p>
<p>On error condition, drop to pdb</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">nosetests</span> <span class="o">--</span><span class="n">pdb</span>
</pre></div>
</div>
<p>On test failure, drop to pdb:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">nosetests</span> <span class="o">--</span><span class="n">pdb</span><span class="o">-</span><span class="n">failures</span>
</pre></div>
</div>
</div><div class="section slide"><p class="rubric" id="python-ides">Python IDEs</p>
</div><div class="section slide"><p class="rubric" id="pycharm">PyCharm</p>
<p>From JetBrains, and integrates some of their vast array of development
tools</p>
<p>Free Community Edition (CE) is available</p>
<p>Good visual debugging support</p>
</div><div class="section slide"><p class="rubric" id="eclipse">Eclipse</p>
<p>A multi-language IDE</p>
<p>Python support via <a class="reference external" href="http://pydev.org/">http://pydev.org/</a></p>
<p>Automatic variable and expression watching</p>
<p>Supports a lot of debugging features like conditional breakpoints,
provided you look in the right places!</p>
<p>Further reading</p>
<p><a class="reference external" href="http://pydev.org/manual_adv_debugger.html">http://pydev.org/manual_adv_debugger.html</a></p>
</div><div class="section slide"><p class="rubric" id="winpdb">winpdb</p>
<p>A multi platform Python debugger with threading support</p>
<p>Easier to start up and get debugging</p>
<div class="highlight-python"><div class="highlight"><pre>winpdb your_app.py
</pre></div>
</div>
</div><div class="section slide"><p class="rubric" id="remote-debugging-with-winpdb">Remote debugging with winpdb</p>
<p>To debug an application running a different Python, even remotely:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">rpdb2</span><span class="p">;</span> <span class="n">rpdb2</span><span class="o">.</span><span class="n">start_embedded_debugger</span><span class="p">(</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference external" href="http://winpdb.org/tutorial/WinpdbTutorial.html">http://winpdb.org/tutorial/WinpdbTutorial.html</a></p>
</div><div class="section slide"><p class="rubric" id="debugging-exercise">Debugging exercise</p>
<p>Find the wikidef app in the examples folder</p>
<p>Using (i)pdb in module mode (python -m pdb ) debug the app and find the
server type that wikipedia is using by looking at
response.headers.headers in Wikipedia.article</p>
<p>You can enter the debugger by running</p>
<div class="highlight-python"><div class="highlight"><pre>python -m pdb ./define.py robot
</pre></div>
</div>
<p>You can get to the code by walking through each line with &#8216;s&#8217;tep and
&#8216;n&#8217;ext commands, or by setting a breakpoint and &#8216;c&#8217;ontinuing.</p>
<p>What&#8217;s the result?</p>
</div><div class="section slide"><p class="rubric" id="questions">Questions?</p>
</div><div aria-role="navigation"><p><a class="reference external" href="#">←</a> <a class="reference external" href="#">→</a></p>
  </div>

/</div></div>
</div>
</div>


          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Christopher Barker, Joseph Sheedy, Maria McKinley.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>